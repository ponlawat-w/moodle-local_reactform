define("local_reactforum/reactions",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=discussionid=>{const react=(metadata,$button,$reactionsarea)=>{if(!parseInt($button.attr("data-reactable")))return!1;const postid=$button.attr("data-post-id"),reactionid=$button.attr("data-reaction-id");$button.prop("disabled",!0);try{_jquery.default.post("".concat(M.cfg.wwwroot,"/local/reactforum/react.php"),{post:postid,reaction:reactionid},(response=>{if($button.prop("disabled",!1),response.error)throw response;((metadata,$button,$reactionsarea,postreactions)=>{const $reactbuttons=$reactionsarea.find(".react-btn");for(const reactbutton of $reactbuttons){const $reactbutton=(0,_jquery.default)(reactbutton),reactionid=$reactbutton.attr("data-reaction-id");postreactions[reactionid]||$reactbutton.prop("disabled",!0),applybutton(metadata,$reactbutton,postreactions[reactionid])}$button.prop("disabled",!1)})(metadata,$button,$reactionsarea,response)}))}catch(ex){throw $button.prop("disabled",!1),ex}},applybutton=(metadata,$button,postreactiondata)=>{$button.removeClass("btn-primary btn-outline-primary"),$button.addClass(postreactiondata.reacted?"btn-primary":"btn-outline-primary");const $counter=$button.find(".reaction-counter");var reactiontype,count;$counter.html(null!==postreactiondata.count?(reactiontype=metadata.reactiontype,count=postreactiondata.count.toString(),"text"===reactiontype?"- ".concat(count):count):""),parseInt(metadata.delayedcounter)&&null===postreactiondata.count?$counter.hide():$counter.show(),$button.attr("data-reactable",postreactiondata.enabled?1:0),$button.css("cursor",postreactiondata.enabled?"pointer":"default")},addreactionbuttons=($forumpost,reactionsdata)=>{const postid=$forumpost.attr("data-post-id"),$appendedelement=(0,_jquery.default)($forumpost.find(".post-content-container")[0]),$reactionsarea=(0,_jquery.default)("<div>");$reactionsarea.addClass("reactions-area");const postdata=reactionsdata.posts[postid];if(postdata){for(const reaction of reactionsdata.reactions){if(!postdata[reaction.id])continue;const postreactiondata=postdata[reaction.id],$button=(0,_jquery.default)("<button>");if($button.addClass("btn react-btn mx-1"),$button.attr("data-post-id",postid).attr("data-reaction-id",reaction.id),"text"===reactionsdata.metadata.reactiontype)$button.html(reaction.reaction);else{if("image"!==reactionsdata.metadata.reactiontype)continue;$button.html((0,_jquery.default)("<img>").addClass("reaction-img").attr("src","".concat(M.cfg.wwwroot,"/local/reactforum/image.php?id=").concat(reaction.id))).attr("alt",reaction.reaction).attr("title",reaction.reaction)}const $counter=(0,_jquery.default)("<span>");$counter.addClass("reaction-counter ml-1"),$button.append($counter),$button.on("click",(function(){react(reactionsdata.metadata,(0,_jquery.default)(this),$reactionsarea)})),applybutton(reactionsdata.metadata,$button,postreactiondata),$reactionsarea.append($button)}$appendedelement.append($reactionsarea)}};(0,_jquery.default)((()=>{(async()=>{const reactionsdata=await new Promise(((resolve,reject)=>{try{_jquery.default.get("".concat(M.cfg.wwwroot,"/local/reactforum/reactionsdata.php?id=").concat(discussionid),(response=>response&&response.metadata?resolve(response):resolve(null)))}catch(ex){reject(ex)}}));if(!reactionsdata)return;reactionsdata.canmanage&&(()=>{const $firstpost=(0,_jquery.default)('.firstpost[data-content="forum-post"]');if(!$firstpost.length)return;const $postactions=$firstpost.find(".post-actions");$postactions.length&&$postactions.append((0,_jquery.default)("<a>").attr("data-region","post-action").attr("href","".concat(M.cfg.wwwroot,"/local/reactforum/managereactions.php?d=").concat(discussionid)).attr("role","menuitem").addClass("btn btn-link").html(M.str.local_reactforum.reactions))})();const $forumposts=(0,_jquery.default)(".forumpost");for(const forumpost of $forumposts)addreactionbuttons((0,_jquery.default)(forumpost),reactionsdata)})()}))}}));

//# sourceMappingURL=reactions.min.js.map