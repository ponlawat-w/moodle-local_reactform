define("local_reactforum/managereactions",["exports","jquery"],(function(_exports,_jquery){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=currentreactionsjsonstr=>{(0,_jquery.default)((()=>{let $maindiv=(0,_jquery.default)("div#fgroup_id_reactions"),$area=$maindiv.find("div.felement"),$filepicker=(0,_jquery.default)("div#fitem_id_reactionimage"),$reactionallreplies=(0,_jquery.default)("div#fitem_id_reactionallreplies"),$delayedcounter=(0,_jquery.default)("div#fitem_id_delayedcounter"),editid=0;const seteditid=x=>{editid=x};$filepicker.hide();let reactiontype="text",reactions=[];const prepare_text_reactions=function(){if("text"!==reactiontype)return;const $reactioninput=(0,_jquery.default)('<input type="text">').attr("class","reaction reaction-text form-control").attr("reaction-id","0").attr("name","reactions[new][]"),$deletebtn=(0,_jquery.default)("<button>").attr("type","button").attr("class","btn btn-danger").html(M.str.local_reactforum.reactions_delete),$reactioninputs_div=(0,_jquery.default)("<div>").attr("class","reaction-input").append($reactioninput).append($deletebtn),$inputcontainer=(0,_jquery.default)("<div>").attr("id","reactions-container"),$addbtn=(0,_jquery.default)("<button>").attr("type","button").attr("class","btn btn-primary").html(M.str.local_reactforum.reactions_add);if($addbtn.on("click",(function(){const $newelement=$reactioninputs_div.clone(!0,!0);$newelement.find("input.reaction-text").val(""),$inputcontainer.append($newelement),$newelement.find("input.reaction-text").trigger("focus")})),$deletebtn.on("click",(function(){const reaction_id=(0,_jquery.default)(this).siblings("input.reaction-text").attr("reaction-id");("0"===reaction_id||confirm(M.str.local_reactforum.reactions_delete_confirmation))&&("0"!==reaction_id?((0,_jquery.default)(this).siblings("input.reaction-text").attr("type","hidden").attr("name","reactions[delete][]").val(reaction_id),(0,_jquery.default)(this).closest("div.reaction-input").hide()):(0,_jquery.default)(this).closest("div.reaction-input").remove())})),$area.html($inputcontainer).append((0,_jquery.default)("<div>").attr("class","container-fluid").css("padding","0").html($addbtn)),reactions.length>0){$inputcontainer.html("");for(const reaction of reactions){const $newelement=$reactioninputs_div.clone(!0,!0);$newelement.find("input.reaction-text").attr("reaction-id",reaction.id).val(reaction.value),"0"===reaction.id?$newelement.find("input.reaction-text").attr("name","reactions[new][]"):$newelement.find("input.reaction-text").attr("name","").on("change",(function(){(0,_jquery.default)(this).attr("name","reactions[edit]["+(0,_jquery.default)(this).attr("reaction-id")+"]")})),$inputcontainer.append($newelement)}}},prepare_image_reactions=function(){if("image"!==reactiontype)return;$area.html("");const $input=(0,_jquery.default)("input#id_reactionimage"),$temp_element=$input.prev().find("div.filepicker-filelist div.filepicker-filename"),temp_html=$temp_element.html();editid=0;const $editheader=(0,_jquery.default)("<h4/>");$editheader.html(M.str.local_reactforum.reactions_selectfile).addClass("reaction-img-edit").hide();const $cancelbtn=(0,_jquery.default)("<button>");$cancelbtn.html(M.str.local_reactforum.reactions_cancel).attr("type","button").attr("class","reaction-img-edit btn btn-default").css("margin","0 5px").on("click",(function(){editid=0,$editheader.hide(),(0,_jquery.default)(".reaction-img-change-btn").prop("disabled",!1)})),$editheader.append($cancelbtn).insertBefore($filepicker.find("input.fp-btn-choose")),$input.on("change",(function(){const $filename=(0,_jquery.default)(this).prev().find("div.filepicker-filename a");void 0!==$filename.attr("href")&&(_jquery.default.post(M.cfg.wwwroot+"/local/reactforum/imageuploaded.php",{url:$filename.attr("href")},(function(tempfileid){if(0===editid){const $newimg=(0,_jquery.default)("<img/>");$newimg.attr("alt",$filename.html()).addClass("reaction-img").attr("src",$filename.attr("href"));const $descriptioninput=(0,_jquery.default)("<input>").attr("type","text").attr("placeholder",M.str.local_reactforum.description).attr("name","reactions[desc][new][".concat(tempfileid,"]")).addClass("form-control"),$deletebtn=(0,_jquery.default)("<button>");$deletebtn.html(M.str.local_reactforum.reactions_delete).attr("type","button").attr("class","btn btn-danger").on("click",(function(){(0,_jquery.default)(this).closest("div.reaction-item").remove()}));const $hiddenelement=(0,_jquery.default)('<input type="hidden" name="reactions[new][]"/>');$hiddenelement.addClass("reaction").val(tempfileid);const $reaction_div=(0,_jquery.default)("<div/>");$reaction_div.attr("class","reaction-item").append($newimg).append($descriptioninput).append($deletebtn).append($hiddenelement),$area.append($reaction_div)}else if(editid>0){$area.find("div#reaction-item-"+editid).find("img.reaction-img").attr("src",$filename.attr("href")),$area.find("input#reaction-image-edit-"+editid).val(tempfileid),$editheader.hide(),editid=0,(0,_jquery.default)(".reaction-img-change-btn").prop("disabled",!1)}}),"text"),$temp_element.html(temp_html))}));for(const reaction of reactions){const $img=(0,_jquery.default)("<img/>");$img.attr("alt",reaction.id).attr("src",M.cfg.wwwroot+"/local/reactforum/image.php?id="+reaction.id+"&sesskey="+M.cfg.sesskey).addClass("reaction-img");const $descriptioninput=(0,_jquery.default)("<input>").attr("type","text").attr("placeholder",M.str.local_reactforum.description).attr("name","reactions[desc][edit][".concat(reaction.id,"]")).addClass("form-control").val(reaction.value),$changebtn=(0,_jquery.default)("<button>");$changebtn.attr("type","button").attr("class","reaction-img-change-btn btn btn-outline-secondary").html(M.str.local_reactforum.reactions_changeimage).on("click",(function(){(0,_jquery.default)(".reaction-img-change-btn").prop("disabled",!1),(0,_jquery.default)(this).prop("disabled",!0),seteditid(reaction.id),$editheader.show()}));const $deletebtn=(0,_jquery.default)("<button>");$deletebtn.html(M.str.local_reactforum.reactions_delete).attr("type","button").attr("class","btn btn-danger").on("click",(function(){if(confirm(M.str.local_reactforum.reactions_delete_confirmation)){const $deletevalue=(0,_jquery.default)('<input type="hidden"/>');$deletevalue.attr("name","reactions[delete][]").val(reaction.id),$area.append($deletevalue),seteditid(0),(0,_jquery.default)(".reaction-img-change-btn").prop("disabled",!1),(0,_jquery.default)(this).closest("div.reaction-item").remove()}}));const $edit=(0,_jquery.default)('<input type="hidden"/>');$edit.attr("name","reactions[edit]["+reaction.id+"]").attr("id","reaction-image-edit-"+reaction.id).addClass("reaction").val("0");const $reaction_div=(0,_jquery.default)("<div/>");$reaction_div.addClass("reaction-item").attr("id","reaction-item-"+reaction.id).append($img).append($descriptioninput).append($changebtn).append($deletebtn).append($edit),$area.append($reaction_div)}$filepicker.show()};(0,_jquery.default)("input[name='reactiontype']").on("change",(function(){if($filepicker.hide(),((0,_jquery.default)("input.reaction").length>0||"discussion"===reactiontype)&&!confirm(M.str.local_reactforum.reactionstype_change_confirmation))return(0,_jquery.default)(this).prop("checked",!1),(0,_jquery.default)('input[name="reactiontype"][value="'+reactiontype+'"]').prop("checked",!0),"image"===reactiontype&&$filepicker.show(),!1;"text"!==(0,_jquery.default)(this).val()&&"image"!==(0,_jquery.default)(this).val()&&"none"!==(0,_jquery.default)(this).val()&&"discussion"!==(0,_jquery.default)(this).val()||(reactiontype=(0,_jquery.default)(this).val(),"text"===reactiontype?(reactions=[{id:"0",value:""}],prepare_text_reactions()):"image"===reactiontype&&(reactions=[],prepare_image_reactions()),"none"===reactiontype||"discussion"===reactiontype?(reactions=[],$maindiv.hide(),$reactionallreplies.hide(),$delayedcounter.hide()):($maindiv.show(),$reactionallreplies.show(),$delayedcounter.show()))}));const currentreactions=JSON.parse(currentreactionsjsonstr);currentreactions?(reactions=currentreactions.reactions,reactiontype=currentreactions.type,$maindiv.hide(),"text"===reactiontype?((0,_jquery.default)("input#id_reactiontype_text").prop("checked",!0),prepare_text_reactions(),$maindiv.show(),$reactionallreplies.show(),$delayedcounter.show()):"image"===reactiontype&&((0,_jquery.default)("input#id_reactiontype_image").prop("checked",!0),prepare_image_reactions(),$maindiv.show(),$reactionallreplies.show(),$delayedcounter.show())):($maindiv.hide(),$reactionallreplies.hide(),$delayedcounter.hide())}))}}));

//# sourceMappingURL=managereactions.min.js.map